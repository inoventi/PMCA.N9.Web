@model dynamic;

@{
    Layout = "_LayoutReportSct";
    ViewData["Title"] = "INCIDENCIAS REPORTADAS";
}
@if (Model.projects != null)
{
    <div class="fresh-datatables" style="margin-top:40px">
        <table id="tablebrachadvances" c class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
            <thead>
                <tr class="div-detail-head" style="font-size: 12px !important;font-weight: bold;background-color: #235b4e;color: #ffffff !important;">
                    <th style="color: #ffffff !important;">Código</th>
                    <th style="color: #ffffff !important;">Proyecto</th>
                    <th style="color: #ffffff !important;">Fase</th>
                    <th style="color: #ffffff !important;">Estatus</th>
                </tr>
            </thead>
            <tbody>
                @{
                    @foreach (var row in Model.projects)
                    {

                        <tr>
                            <td>@row.Code</td>
                            <td>@row.Name</td>
                            <td>@row.Fase</td>
                            <td>
                                @if (@row.Estatus == 1)
                                {
                                    <span class="bold ws st-entiempo ws"><strong>En tiempo</strong></span>
                                }
                                @if (@row.Estatus == 2)
                                {
                                    <span class="bold st-atrasado ws"><strong>Atrasado</strong></span>
                                }
                                @if (@row.Estatus == 3)
                                {
                                    <span class="bold ws st-cimpacto ws"><strong>Con impacto</strong></span>
                                }
                                @if (@row.Estatus == 4)
                                {
                                    <span class="bold ws st-cerrado ws"><strong>Terminado</strong></span>
                                }
                                @if (@row.Estatus == 5)
                                {
                                    <span class="bold ws st-cancelado  ws"><strong>Cancelado</strong></span>
                                }
                                @if (@row.Estatus == 6)
                                {
                                    <span class="bold ws st-suspendido ws"><strong>Archivado</strong></span>
                                }

                            </td>
                        </tr>
                        @foreach (var i in Model.incidents)
                        {
                            if (row.ProjectID == i.ProjectID)
                            {
                                <tr data-dinamytr="true">
                                    <td scope='row' style="text-align: center;">
                                        <img src="/images/arrowReport.png" style="width: 39px;">
                                    </td>
                                    <td colspan='6'>
                                        <table class="table table-bordered tbcp" style="border-left: 4px solid #235b4e;">
                                            <thead>
                                                <tr style="font-size: 12px !important;font-weight: bold;background-color: #235b4e;color: #ffffff !important;">
                                                    <th style="color: #ffffff !important;" scope="col">Incidente</th>
                                                    <th style="color: #ffffff !important;" scope="col">Elemento relacionado</th>
                                                    <th style="color: #ffffff !important;" scope="col">Fecha de solución</th>
                                                    <th style="color: #ffffff !important;" scope="col">Acciones</th>
                                                    <th style="color: #ffffff !important;" scope="col">Estatus</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="tr-cp">
                                                    <th scope="row">@i.Description</th>
                                                    @if (@i.TaskID != null)
                                                    {
                                                        <td><a>@i.TaskDescripcion</a></td>
                                                    }
                                                    @if (i.EvidenceID != null)
                                                    {
                                                        <td><a>@i.EvidenceDescripcion</a></td>
                                                    }
                                                    <td>@i.PlannedEndDate</td>
                                                    <td>
                                                        @{
                                                            string comment = @i.ActionPlan;
                                                            if (comment != null)
                                                            {
                                                                comment = comment.Replace("|", "<br>");
                                                            }
                                                        }

                                                        @Html.Raw(@comment)
                                                    </td>
                                                    @switch (@i.Status)
                                                    {
                                                        case 1:
                                                            <td><span class="bold ws st-entiempo ws">En tiempo</span></td>

                                                            break;
                                                        case 2:
                                                            <td><span class="bold st-atrasado ws">Atrasado</span></td>

                                                            break;
                                                        case 3:
                                                            <td><span class="bold ws st-cimpacto ws">Con impacto</span></td>

                                                            break;
                                                        case 4:
                                                            <td><span class="bold ws st-cerrado ws">Terminado</span></td>

                                                            break;
                                                        case 5:
                                                            <td><span class="bold ws st-cancelado  ws">Cancelado</span></td>

                                                            break;
                                                        case 6:
                                                            <td><span class="bold ws st-suspendido ws">Archivado</span></td>

                                                            break;
                                                    }
                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                            }
                        }
                    }
                }
            </tbody>
        </table>
    </div>

}
else
{
    <h5 class="color-font-global">No se encontraron resultados para los filtros ingresados</h5>
}
